---
title: "Study 3"
output: 
  html_document:
  #   toc: true
  #   toc_float: true
    code_folding: hide
  #   fig_caption: yes
  #   theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#IMPORT LIBRARIES
library(jsonlite)
library(tables) # pretty tables
library(pastecs) #stat.desc
library(ggplot2) #graphs
library(car) #ANOVA

#Create data frame for participant file
participant_file <- "../STUDY_3/Analysis/data/final_participants.json"
df_subjects <- fromJSON(participant_file)

#set condition levels as factors
levels(df_subjects$impasse)<- c("1","2")
levels(df_subjects$explicit)<- c("1","2","3")

df_subjects$explicit<-factor(df_subjects$explicit)
df_subjects$impasse<-factor(df_subjects$impasse)

#Create subset df for each condition
df_1 <- subset(df_subjects, explicit==1)
df_2 <- subset(df_subjects, explicit==2)
df_3 <- subset(df_subjects, explicit==3)

levels(df_1$impasse)<- c("1","2")
levels(df_1$explicit)<- c("1","2","3")

#Create factor vectors
EXPLICIT <- factor(df_subjects$explicit, levels = c(1,2,3), labels = c("none", "text/image", "interactive"))
IMPASSE  <- factor(df_subjects$impasse, levels = c(1,2), labels = c("none", "impasse"))
AXIS  <- factor(df_subjects$axis)

df_subjects$tt_min <- df_subjects$triangular_time / 1000 / 60

#Count number of participants
nSubjects <- nrow(df_subjects)
nFemale <-sum(df_subjects$sex == "Female")
```
#Comparing Explicit and Implicit Scaffolding   {.tabset .tabset-fade .tabset-pills} 
<br> 

##Introduction   
The purpose of this study is to compare the relative efficacy of *explicit* (ie. visually-salient text or images that serve instructional purpose) and *implicit* (ie. task and question structure) scaffolding for an unconventional statistical graph.  We hypothesize that implicit techniques---specifically presenting a task that forms a **mental impasse** for the reader---will be more supportive of correct graph interpretation than explicit graph-reading instructions.  We base this hypothesis on prior observation and experimental work (Fox & Hollan, *in preparation*) which revealed that when presented with an unconventional graph with structural elements (ie. axes and grid) that resembled conventional graphs, learners did not always realize they did not understand how the graph was meant to be read. We propose that prior knoweldge of conventional graph systems acts as a form of "graphical fixedness", that learners must overcome to form correct mental models for new representational systems. 
<br><br>

**IN PROGRESS DATA COLLECTION TOTALS**   

```{r results = 'asis', echo = FALSE}
#create table of participants by factors (explicit X impasse)
table <- tabular( (IMPASSE+1)~(EXPLICIT+1), data = df_subjects )
table_options(rowlabeljustification="center", justification="right")
html(table,options=htmloptions(head=TRUE))
```   
<br><br>

###Hypotheses
Based on the results from Study 2 we predict ...   
(1) No significant differences will be found the static explicit scaffolds (control, text/image) when no implicit scaffold is present.   
(2) Significant differences will be found between the interactive and all other explicit scaffolds.   
Based on our hypotheses, we predict...   
(3) A significant interaction between implicit & explicit scaffold (implicit scaffold will be equally effective across all types of explicit scaffold)   
(4) The implicit scaffold will be more effective than any of the explicit scaffolds ( explicit[none]implicit[impasse] will be significantly better than all of the explicit[]implicit[none] conditions)   


##Methods
###Design
We utilized a 3 (explicit scaffold: none, text/image, interactive) X 2 (implicit scaffold: none, impasse) between-subjects factorial design, with response time and score (max = 15) as dependent variables.   
<br>   

###Participants

**`r nSubjects` students ** (``r round(nFemale/nSubjects,digits = 2) * 100`` % female) registered as STEM majors at a public university in the United States participated in exchange for course credit (age: ``r min(df_subjects$age)`` - ``r max(df_subjects$age)`` years).
<br><br>

###Measures
```{r echo = FALSE}
#EXPLORE SAMPLE STATISTICS

#describe the sample
describe_score<-stat.desc(df_subjects$triangular_score) 
describe_time<-stat.desc(df_subjects$tt_min) 

time_min = round(describe_time[4], 0)
time_max = round(describe_time[5], 0)
time_m = round(describe_time[9], 0)
time_sd = round(describe_time[10], 2)
 
score_min = round(describe_score[4], 0)
score_max = round(describe_score[5], 0)
score_m = round(describe_score[9], 0)
score_sd = round(describe_score[10], 2)

#tests for normalcy
score_normal <- shapiro.test(df_subjects$triangular_score)
time_normal <- shapiro.test(df_subjects$tt_min)

```

####Response Accuracy   
The mean score across the entire sample was approximately `r score_m` points (out of 15), with a standard deviation of `r score_sd` , and values ranging from `r score_min` to `r score_max`  points.    
<br> <br> <br> 
```{r echo = FALSE}
#SCORE HISTOGRAM
HIST_score <-ggplot(df_subjects, aes(triangular_score)) 
HIST_score + geom_histogram(binwidth=1) + 
  coord_cartesian(xlim=c(0,15)) +
  ggtitle("Total Score") + 
  labs(x="Score (points)", y="Number of Participants") + 
  theme_bw()+
  theme(strip.background = element_blank())+
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=14, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  theme(panel.border = element_blank())
```

<br><br> 
<span style="color:red"> 
A Shapiro-Wilk test for normality yielded a value of ```r score_normal[1]```, p = ```r score_normal[2]``` suggesting that the distibution is significantly non-normal.    
</span>    
<br><br> 

```{r echo = FALSE}
#BOXPLOT of SCORE BY EXPLICIT & IMPLICIT
BP_score <- ggplot(df_subjects, aes(EXPLICIT,triangular_score, fill=IMPASSE))+ geom_boxplot() +
  labs(x="Explicit Scaffold", y="Total Score (points)", color="IMPASSE")+ 
  ggtitle("Score by Scaffold & Impasse") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_fill_manual(   values = c("grey","pink"),
                       name="Impasse",
                       breaks=c(1, 2),
                       labels=c("control", "impasse"))
BP_score
```
<br> <br> <br>
```{r echo = FALSE}
#ASSESS NORMALITY OF SCORE
QP_time <- qplot(sample = df_subjects$triangular_score, main="Q-Q Plot: SCORE") + theme_bw() 
QP_time
```

####Response Latency
The mean total runtime across the sample was approximately `r time_m` minutes, with a standard deviation of `r time_sd` minutes, and values ranging from `r time_min` to `r time_max`  minutes. 
<br><br><br>
```{r echo = FALSE}
#TIME HISTOGRAM
HIST_time <-ggplot(df_subjects, aes(tt_min)) 
HIST_time + geom_histogram(binwidth=1) + 
  coord_cartesian(xlim=c(0,15)) +
  ggtitle("Response Time") + 
  labs(x="Time (min)", y="Number of Participants") + 
  theme_bw()+
  theme(strip.background = element_blank())+
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=14, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  theme(panel.border = element_blank())
```

<br><br>
<span style="color:red"> 
A Shapiro-Wilk test for normality yielded a value of ```r time_normal[1]```, p = ```r time_normal[2]``` suggesting that the data are from a normally-distributed population. 
</span>    
<br><br>

```{r echo = FALSE}
#BOXPLOT of TIME BY EXPLICIT & IMPLICIT
BP_time <- ggplot(df_subjects, aes(EXPLICIT,tt_min, fill=IMPASSE))+ geom_boxplot() +
  labs(x="Explicit Scaffold", y="Time (min)", color="IMPASSE")+ 
  ggtitle("Time by Scaffold & Impasse") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_fill_manual(   values = c("grey","pink"),
                       name="Impasse",
                       breaks=c(1, 2),
                       labels=c("control", "impasse"))
BP_time
```
<br> <br> <br>
```{r echo = FALSE}
#ASSESS NORMALITY OF TIME
QP_time <- qplot(sample = df_subjects$tt_min, main="Q-Q Plot: TIME") + theme_bw() 
QP_time
```

##Results
###Response Accuracy
```{r results = 'asis', echo = FALSE}
#Create a tables of means for task scores 
table<- tabular( (IMPASSE) ~ (Heading("EXPLICIT Scaffold")*EXPLICIT)
                            *(Heading("")*triangular_score) 
                            *(mean+sd)
                            *Format(digits=2),
                            data=df_subjects)
html(table,options=htmloptions(head=TRUE))
#latex(table)
```
<br><br><br>

#####STATISTICAL MODEL: Factorial ANOVA (explicit scaffold X impasse)  on SCORE

(Expected Results)
<!--html_preserve-->
<img src="Study3_files/figure-html/expected_results.png" height="200" width="350" > 
<!--/html_preserve-->


```{r collapse=TRUE}
#FACTORIAL ANOVA ON LM OF 
# model = lm(triangular_score ~ explicit + impasse + explicit:impasse,
#            data = df_subjects)
# Anova(model,type = "II")

 aov.out = aov(triangular_score ~ explicit * impasse, data=df_subjects)
options(show.signif.stars=T)
 summary(aov.out)
options(show.signif.stars=T)
        TukeyHSD(aov.out, show.signif.stars=T)
```
<br><br><br>
```{r echo = FALSE}
#INTERACTION PLOT FOR SCORE
ggplot(df_subjects)+
  aes(x = IMPASSE, y = triangular_score, colour = EXPLICIT, group=EXPLICIT) +
  stat_summary(fun.y=mean, geom="point") +
  stat_summary(fun.y=mean, geom="line") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width=0.1) +
  coord_cartesian(ylim= c(1,15)) +
  labs(title = "Effect of implict & explicit scaffolds on Score",
       subtitle = "Error bars indicate standard error of the mean") +
  xlab("Implicit Scaffold")+
  ylab("Score")
```


####HYPOTHESIS 1: The formation of a question as a mental impasse will significantly improve performance on the problems

##### A) Perform pairwise comparison of impasse vs. non-impasse within each explicit scaffold condition

```{r collapse=TRUE}
#CALULCULATE PAIRWISE DIFFERENCE & EFFECT SIZE (independent sample t-test with numeric y and binary x)
mainEffectGraph  <- t.test(triangular_score ~ impasse, data=df_1)
mainEffectGraph

t <-mainEffectGraph$statistic[[1]]
t <-round(t,2)
df <-round(mainEffectGraph$parameter[[1]],0)
p <-mainEffectGraph[3] 
r <- sqrt(t^2/(t^2+df))
r <-round(r,2)
r

#explore descriptive statistics based on each IV
desc_control <- by(df_1$triangular_score, list(df_1$impasse), stat.desc, basic=FALSE)
desc_control
nonimpasse_mean = desc_control$`1`[2]
nonimpasse_SD = desc_control$`1`[6]
impasse_mean = desc_control$`2`[2]
impasse_SD = desc_control$`2`[6]
```

For participants in the no-scaffold control condition, we see that we see participants presented with non-impasse questions (M = `r round(nonimpasse_mean,2)`, SD = `r round(nonimpasse_SD)`) are significantly *lower* than those with impasse questions (M = `r round(impasse_mean,2)`, SD = `r round(impasse_SD)`), t(`r df`) = `r t`, p = `r p[[1]]` , r = `r r`. 

```{r} 
# bar <- ggplot(df_1, aes(x = impasse, y= triangular_score)) 
# bar + stat_summary(aes(y = triangular_score, group=impasse), fun.y=mean,  geom="bar", position="dodge") +
#       stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
#       labs (x = "Graph Task ", y= "Score", fill="Graph Task") +
#       coord_cartesian(ylim=c(0,15)) +
#       scale_x_discrete(labels=c("non-impasse" = "impasse"))+ 
#       theme_bw() +
#       theme(strip.background = element_blank()) +
#       ggtitle("Mean Score for no-scaffold by Impasse Structure")
```



##### A) Examine enter question set (only first 5 are scaffolded)
##### B) Examine scaffolded phase only 





###Response Time

```{r results = 'asis', echo = FALSE}
#Create a tables of means for task runtime 
table<- tabular( (IMPASSE) ~ (Heading("EXPLICIT Scaffold")*EXPLICIT)
                            *(Heading("")*tt_min) 
                            *(mean + sd)
                            *Format(digits=2), 
                            data=df_subjects)
html(table,options=htmloptions(head=TRUE))
#latex(table)
```
<br><br><br>
```{r echo = FALSE}
model = lm(tt_min ~ explicit + impasse + explicit:impasse,
           data = df_subjects)
Anova(model,type = "II")
```
<br><br><br>
```{r echo = FALSE}
#INTERACTION PLOT FOR TIME
ggplot(df_subjects)+
  aes(x = IMPASSE, y = tt_min, colour = EXPLICIT, group=EXPLICIT) +
  stat_summary(fun.y=mean, geom="point") +
  stat_summary(fun.y=mean, geom="line") +
  # stat_summary(fun.data = mean_se, geom = "errorbar", width=0.1) +
  coord_cartesian(ylim= c(1,15)) +
  labs(title = "Effect of implict & explicit scaffolds on Time",
       subtitle = "Error bars indicate standard error of the mean") +
  xlab("Implicit Scaffold")+
  ylab("Score")
```
```