---
title: "Study 2" 
output:
  html_document: 
    code_folding: hide  
    fig_caption: true
  # :
  #   toc: true
  #   toc_float: true
  #   toc_depth: 3
---
```{r echo = FALSE}
#LOAD PACKAGES
suppressPackageStartupMessages({
  library(tidyverse)
  library(stringr)
  library(readr) #load csv
  library(pastecs) #stat.desc
  library(tables) # pretty tables
  library(dplyr) #data formatting
  library(ez) #mixed anova
  library(reshape2) #reformatting data
  library(car)   #statistics
  library(ggplot2) #graphs!
  library(psych) #describeby
  library(gridExtra) #arranging plots
  library(ez) # anova
  library(nlme) #multilevel model
  library(lme4) #better mixed model
  library(WRS2) #robust tests
  library(multcomp) # post-hoc tests on repeated-measures anova
  library(rcompanion) # chi square post hocs
  #library(sjstats) # convenient effect size for anovas



})
```

```{r echo = FALSE}
#LOAD THE PARTICIPANT DATA
all_participants2 <- read_csv("../STUDY_2/Analysis/xls-files/master-wrangled-data/all_participants.csv", 
    col_types = cols(ARF = col_skip(), Comments = col_skip(), 
        `Graph Description (if other)` = col_skip(), 
        `Graph Title` = col_skip(), `Graph Type` = col_factor(levels = c("Triangular (right angle)", 
            "Triangular", "Linear Model", 
            "Scatterplot", "Other", "Triangular (asymmetric)")), 
        Points = col_skip(), Rater = col_skip(), 
        `Select each item that is labelled in the graph` = col_skip(), 
        `X Axis` = col_skip(), `Y Axis` = col_skip(),
        GENDER = col_factor(levels = c("Male", 
        "Female","Other")),
        condition = col_factor(levels = c("0", 
            "1", "2", "3", "4")), d_t = col_skip(), 
        d_t_2 = col_skip(), experiment = col_factor(levels = c("experiment", 
            "reverse")), linear_time = col_skip(), 
        lm_scenarios = col_factor(levels = c("axis", 
            "longmire")), ls_t = col_skip(), 
        lt_t = col_skip(), time_diff = col_skip(), 
        tm_scenarios = col_factor(levels = c("longmire", 
            "axis")), triangular_time = col_skip(), 
        ts_t = col_skip(), tt_t = col_skip() ))
#View(all_participants2)
```

```{r echo = FALSE}
#SETUP LABELS AND COLORS FOR GRAPHS
order_labels <- c(LMFirst = "linear-first", TMFirst = "triangular-first")
scenario_labels <- c(axis = "task-scenario A", longmire = "event-scenario B")
condition_labels <-c( '0' = "no scaffold", '1' = "what-text", '2' = "how-text", '3' = "static image", '4' = "interactive image")
task_labels <- c("LM_T_M" = "linear graph", "TM_T_M" = "triangular graph")

  red = "#F8766D"
  green = "#1cc07e"
  blue = "#59A1FC"
  purple = "#C680FD"
  none = "#7E7D7E"
  text1 = "#071FD5"
  text2 = "#0C91DF"
  img1 = "#EF007A"
  img2 = "#c481d5"
```

```{r echo = FALSE}
#SETUP DATA FRAMES
#create copy data of base data frame 
df_subjects2 <- cbind(all_participants2)

#create a new column for order with better name
df_subjects2$order = df_subjects2$experiment
levels(df_subjects2$order)[levels(df_subjects2$order)=="experiment"] <- "LMFirst"
levels(df_subjects2$order)[levels(df_subjects2$order)=="reverse"] <- "TMFirst"

#create a column for the sum of the two graphing tasks (graphScore)
df_subjects2$graphScore = df_subjects2$linear_score + df_subjects2$triangular_score

#create a column for the sum of the two drawing tasks (graphScore)
df_subjects2$drawScore = df_subjects2$points + df_subjects2$d_n

#create data subsets
df_regular <- subset(df_subjects2, experiment=="experiment")
df_reverse <- subset(df_subjects2, experiment=="reverse")
df_control <- subset(df_subjects2, condition==0)
```

# Evaluating scaffolds for an unconventional statistical graph {.tabset .tabset-fade .tabset-pills}  
<br> 

## Introduction    
<br>
In Study Two we examine if scaffolding is effective in aiding untrained students to understand the Triangular Model (TM) graph.  We know that students are unlikely to construct the correct interpretation of the TM without assistance.  Guided by the results of the Study One Design Task, we created four scaffolds.  We test the effectiveness of these scaffolds by seeking to replicate the Qiang et.al (2014) finding that after 20 minutes of video training, students perform faster and more accurately with the unconventional TM than the conventional Linear Model (LM). Will our participants show similar performance on the TM with scaffolds rather than formal instruction? Further, will engagement with the TM in a reading task be sufficient for students to reproduce the graph in a subsequent drawing task?  
<br>

### Hypotheses
1. Learners without scaffolding (control) will perform better with the LM than TM    
2. Learners with (any form of) scaffolding will perform better with the TM than LM (replication of [12]).     
3. Based on observations in Study One we expect that graph-order will act as a scaffold. Learners who solve problems with the LM graph first will perform better on the TM (relative to TM-first learners) as their attention will be drawn to the salient differences between the graphs.    
<br>   

--- 
**To try the study yourself: **
visit http://morning-gorge-17056.herokuapp.com/     
*Enter "github" as your session code, and number of the condition you wish to test*    
0 = control (no-scaffold), 1 = "what-text", 2 = "how-text", 3 = "static-image", 4 = "interactive-image"     
<br> <br>


## Methods   
### Design
We employed a 5 (scaffold: none-control, what-text, how-text, static image, interactive image) x 2 (graph: LM, TM) mixed design, with scaffold as a between-subjects variable and graph as a within-subject variable. To test our hypothesis that exposure to the conventional LM acts as a scaffold for the TM, we counterbalanced the order of graph-reading tasks (order: LM-first, TM-first). For each task we measured response accuracy and time.  For the follow-up graph-drawing task, a team of raters coded the type of graph produced by each participant.  
<br>  

### Participants
```{r echo = FALSE}
#EXPLORE SAMPLE STATISTICS

#record sample size
nSubjects = nrow(df_subjects2)
nReg = nrow(df_regular)
nRev = nrow(df_reverse)

#how many women?
nFemale <-nrow(filter(df_subjects2, df_subjects2$GENDER == 'Female'))

#describe the sample
descriptives<-stat.desc(df_subjects2)
#descriptives

#determine age range
age_min = descriptives$AGE[4]
age_max = descriptives$AGE[5]
age_m = round(descriptives$AGE[9], 2)
age_sd = round(descriptives$AGE[10], 2)


time_min = round(descriptives$TOTAL_T_M[4], 0)
time_max = round(descriptives$TOTAL_T_M[5], 0)
time_m = round(descriptives$TOTAL_T_M[9], 0)
time_sd = round(descriptives$TOTAL_T_M[10], 2)

```

`r nSubjects` (`r round(nFemale/nSubjects,2) * 100`% female) students aged `r age_min` to `r age_max` at a public American univeristy participated in the study. 
All participants completed three activities: two graph reading tasks (with both the linear model (LM) and triangular model (TM) graphs) followed by a drawing task. In some cases (linear-first), participants (n = `r nReg`) completed the graph reading task with the LM graph, followed by the task with the TM graph. An additional (n= `r nRev`) subjects completed the graph reading tasks in reverse order. Each particiant was randomly assigned to one of five conditions which determined what additional information (scaffold) they received while solving the first five problems with each graph: no-scaffold (control), 'what' text, 'how'-text, static-image, and interactive-image. The runtime of the entire study ranged from `r time_min` to `r time_max` minutes (m = `r time_m`, sd = `r time_sd`). 
<br> <br>

### Materials
#### Scaffolds
For the first five questions of each graph-reading task, participants saw their assigned scaffold along with the designated graph. On the following ten questions, the scaffold was not present. Examples of each scaffold-condition for the TM and LM graphs are shown below. 
<br> <br>

<!--html_preserve-->
<table style="width:100%">
  <tr>
    <th>Scaffold Condition</th>
    <th>Linear Model (LM)</th>
    <th>Triangular Model (LM)</th> 
  </tr>
  <tr>
    <td>none-control</td>
    <td><img src="static/Study2/0-LM.png" height="200" width="200" ></td> 
    <td><img src="static/Study2/0-TM.png" height="200" width="200" ></td> 
  </tr>
  <tr>
    <td>"what-text"</td>
    <td><img src="static/Study2/1-LM.png" height="200" width="350"></td> 
    <td><img src="static/Study2/1-TM.png" height="200" width="350"></td> 
  </tr>
  <tr>
    <td>"how-text"</td>
    <td><img src="static/Study2/2-LM.png" height="200" width="350" ></td> 
    <td><img src="static/Study2/2-TM.png" height="200" width="350" ></td> 
  </tr>
  <tr>
    <td>"static-image"</td>
    <td><img src="static/Study2/3-LM.png" height="200" width="200"></td> 
    <td><img src="static/Study2/3-TM.png" height="200" width="200"></td> 
  </tr>
  <tr>
    <td>"interactive-image"</td>
    <td><img src="static/Study2/4-LM.png" height="200" width="350"></td> 
    <td><img src="static/Study2/4-TM.png" height="200" width="350"></td> 
    <td></td>
  </tr>  
</table>
<!--/html_preserve-->
<br> <br>

#### The Graph Reading Task
Each graph reading task consisted of a graph (LM or TM) and 15 multiple choice questions (used in Study One). Questions were presented one at a time, and participants did not receive feedback as to the accuracy of their response before proceeding to the next question. The order of the first five (scaffolded) questions was the same for each participant, while the order of the remaining 10 were randomized. For each question, the stimulus software recorded the participant’s response accuracy (correct, incorrect) and latency (time from page-load to “submit” button press). As each participant completed the reading task once with each graph, we developed two matched scenarios: a project manager scheduling tasks (scenario A), and an events manager scheduling reservations (scenario B). In each scenario, an equivalent question can be identified in the other pertaining to the same interval property or relation. For the LM graphs, intervals were sorted in order of duration, with the longest intervals appearing at the top of the graph.A pilot study on Amazon Mechanical Turk using the LM graph revealed no significant differences in difficulty between the scenarios. The four graphs constructed for the study are shown below. 

<a href="static/Study2/questions.html"> **The full list of questions and correct answers can be found here** </a>.

<br> <br>
<!--html_preserve-->
<table style="width:100%">
  <tr>
    <th>Task Scheduling (Scenario A)</th>
    <th>Event Scheduling (Scenario B)</th> 
  </tr>
  <tr>
    <td><img src="static/Study2/axis.png" height="200" width="350" ></td> 
    <td><img src="static/Study2/longmire.png" height="200" width="350" ></td> 
  </tr>
  <tr>
    <td><img src="static/Study2/0-LM.png" height="200" width="200" ></td> 
    <td><img src="static/Study2/5-LM.png" height="200" width="200" ></td> 
  </tr>
  <tr>
    <td><img src="static/Study2/0-TM.png" height="200" width="200"></td> 
    <td><img src="static/Study2/5-TM.png" height="200" width="200"></td> 
  </tr>
</table>
<!--/html_preserve-->
<br> <br>

#### The Graph Drawing Task
In the <!--html_preserve--><a href="static/Study2/drawing_task.pdf"> graph drawing task</a><!--/html_preserve--> participants were given a sheet of isometric dot paper and a table containing a set of 10 time intervals. Isometric dot paper equally supports the construction of lines at 0, 45 and 90 degrees, thus minimizing any biasing effects of the paper on the type of graph the participants chose to draw. Participants were directed to draw a triangular graph of the data (“like the triangle graph you saw in the previous task”), using the pencil, eraser and ruler provided. 
<!--html_preserve--><br> <br><!--/html_preserve-->


### Procedure
Participants completed the study individually in a computer lab. After a short introduction they continued to the first of two graph reading tasks (graph order counterbalanced). After completing the first graph reading task, they were introduced to the second scenario, and completed the second graph reading task with the remaining graph. Finally, participants completed the graph drawing task. They finished the study by completing a short demographic survey, and reading the debriefing text. 
<br> <br>

## Results (Score) 
```{r echo = FALSE}
#SETUP DATA FOR RESPONSE ACCURACY ANALYSIS
# our data df_subjects2 is in wide format (repeated measures in different columns), however we need it in long format
w_scores = subset(df_subjects2, select = c("subject","condition", "order", "lm_scenarios", "linear_score","triangular_score")) #create a wide form subset 
l_scores <-melt(w_scores, id=c("subject","condition", "order", "lm_scenarios"), measured=c("linear_score","triangular_score")) 

#convert other variables to factors
l_scores$condition <- factor(l_scores$condition)
l_scores$order <- factor(l_scores$order)
l_scores$lm_scenarios <- factor(l_scores$lm_scenarios)
levels(l_scores$condition)[levels(l_scores$condition)=="0"] <- "control"
levels(l_scores$condition)[levels(l_scores$condition)=="1"] <- "wtext"
levels(l_scores$condition)[levels(l_scores$condition)=="2"] <- "htext"
levels(l_scores$condition)[levels(l_scores$condition)=="3"] <- "simage"
levels(l_scores$condition)[levels(l_scores$condition)=="4"] <- "ximage"
l_scores$scaffold <-l_scores$condition


#SETUP DATA FOR RESPONSE ACCURACY ANALYSIS FOR CONTROL CONDITION ONLY
# our data df_subjects2 is in wide format (repeated measures in different columns), however we need it in long format
w_scores_control = subset(df_control, select = c("subject", "order", "lm_scenarios", "linear_score","triangular_score")) #create a wide form subset 
l_scores_control <-melt(w_scores_control, id=c("subject","order", "lm_scenarios"), measured=c("linear_score","triangular_score")) 

#convert other variables to factors
l_scores_control$order <- factor(l_scores_control$order)
l_scores_control$lm_scenarios <- factor(l_scores_control$lm_scenarios)
```

###Explore the data
*We see a large variance in TM scores across Graph-Orders*

```{r}
#EXPLORE THE DATA
#create boxplot

#SIMPLE BOXPLOT BY CONDITION
# mixedPlot_condition <- ggplot(l_scores, aes(condition,value, color=variable))+ geom_boxplot() +
#  labs(x="scaffold condition", y="score (max = 15)") +
#  ggtitle("Task Score by Scaffold ") +
#  theme_bw()
# mixedPlot_condition
  
#BOXPLOT BY CONDITION, FACET WITH ORDER
mixedPlot_order <- ggplot(l_scores, aes(condition,value, fill=variable))+ geom_boxplot() +
  facet_wrap(~order, labeller=labeller(order = order_labels)) +
  labs(x="scaffold condition", y="score (max = 15)", color="task")+ 
  labs(title="Task Score by Scaffold & Graph-Order ") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_fill_manual( values = c(green,red),
                       name="graphing task",
                       breaks=c("linear_score", "triangular_score"),
                       labels=c("linear", "triangular")) 
mixedPlot_order

#BOXPLOT BY CONDITION, FACET WITH ORDER AND SCENARIO
mixedPlot_scenario <- ggplot(l_scores, aes(condition,value, fill=variable))+ geom_boxplot() +
 facet_grid(lm_scenarios~order, labeller=labeller(order = order_labels)) +
 labs(x="scaffold condition", y="score (max = 15)")+
 ggtitle("Task Score by Scaffold, Task Order and Scenario ") +
 theme_bw() +
 theme(strip.background = element_blank()) +
 scale_fill_manual( values = c(green,red),
                       name="graphing task",
                       breaks=c("linear_score", "triangular_score"),
                       labels=c("linear", "triangular"))
  #use scale_fill_manual to manually change colors 
mixedPlot_scenario
``` 

### Hypothesis 1: Scaffold conditon and graph-order will not affect performance on the LM graph, because it is conventional and relatively easy to read

When we compare LM scores both graph-orders and scaffold-conditions (and scenarios), we do not find significant differences
```{r collapse=TRUE}
#explore descriptive statistics based on each IV

#LM SCORES BY SCAFFOLD
desc_control <- by(w_scores$linear_score, list(w_scores$condition), stat.desc, basic=FALSE)
desc_control

#LM SCORES BY GRAPH-ORDER
desc_control <- by(w_scores$linear_score, list(w_scores$order), stat.desc, basic=FALSE)
desc_control

#ONE WAY ANOVA ON LM_SCORE BY SCAFFOLD
#construct contrasts for ANOVA model
options(contrasts=c("contr.sum","contr.poly"))

simpleModel = ezANOVA(data = w_scores,
                     dv = .(linear_score),
                     wid = .(subject),
                     between = .(condition),
                     type = 3,
                     detailed = TRUE)
simpleModel

#ONE WAY ANOVA ON LM_SCORE BY GRAPH-ORDER
simpleModel = ezANOVA(data = w_scores,
                     dv = .(linear_score),
                     wid = .(subject),
                     between = .(order),
                     type = 3,
                     detailed = TRUE)
simpleModel

#ONE WAY ANOVA ON LM_SCORE BY SCENARIO
simpleModel = ezANOVA(data = w_scores,
                     dv = .(linear_score),
                     wid = .(subject),
                     between = .(lm_scenarios),
                     type = 3,
                     detailed = TRUE)
simpleModel
```




### Hypothesis 2: Learners without scaffolding (control) will perform better with the LM than TM. 
```{r collapse=TRUE}
#explore descriptive statistics based on each IV
desc_control <- by(l_scores_control$value, list(l_scores_control$variable), stat.desc, basic=FALSE)
desc_control
LM_mean = desc_control$linear_score[2]
LM_SD = desc_control$linear_score[6]
TM_mean = desc_control$triangular_score[2]
TM_SD = desc_control$triangular_score[6]
```

If we compare LM and TM scores (across both graph-orders) for the participants in the control condition, we expect their LM scores will be significantly higer than the TM scores.    

```{r collapse=TRUE}
#CALULCULATE POSTHOC DIFFERENCE & EFFECT SIZE
mainEffectGraph  <- t.test(value ~ variable, data=l_scores_control, paired=TRUE)
mainEffectGraph

t <-mainEffectGraph$statistic[[1]]
t <-round(t,2)
df <-mainEffectGraph$parameter[[1]]
p <-mainEffectGraph[3] 
r <- sqrt(t^2/(t^2+df))
r <-round(r,2)
r
```

Across all factors, we see that LM scores (M = `r round(LM_mean,2)`, SD = `r round(LM_SD,2)`) are significantly higher than TM scores (M = `r round(TM_mean,2)`, SD = `r round(TM_SD,2)`), t(`r df`) = `r t`, p = `r p[[1]]` , r = `r r`. 

```{r} 
bar <- ggplot(l_scores_control, aes(x = variable, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task ", y= "Score", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("linear_score" = "Linear Graph (LM)", "triangular_score" = "Triangular Graph (TM)")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Graph Task")+
      scale_fill_manual(values = c(green,red),
                        name = "Graph Task",
                        breaks =c("linear_score", "triangular_score"),
                        labels =c("linear","triangular"))
```

### Hypothesis 3: Learners with (any form of) scaffolding will perform better with the TM than LM (replication of Qiang et al  (2014)). 
If we compare LM and TM scores in each scaffold condition (2-4) we expect to find that TM scores are higher than LM scores. 
Instead, we find that TM scores are on average lower than LM scores in every condition.   

```{r collapse=TRUE}
#explore descriptive statistics based on each IV
desc <- by(df_subjects2$score_diff, list(df_subjects2$condition), stat.desc, basic=FALSE)
desc
# LM_mean = desc_control$linear_score[2]
# LM_SD = desc_control$linear_score[6]
# TM_mean = desc_control$triangular_score[2]
# TM_SD = desc_control$triangular_score[6]
```

```{r} 
bar <- ggplot(df_subjects2, aes(x = condition, y= score_diff))
bar + stat_summary(aes(y = score_diff, group=condition), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Scaffold", y= "Score Difference (TM-LM)") +
      coord_cartesian(ylim=c(-15,15)) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Score Difference by Scaffold") +
      scale_x_discrete(labels=c( "0" = "none-control", "1" = "what-text", "2"="how-text", "3"="static-img", "4"="ix img")) 
```

```{r collapse = TRUE}
#REPEATED MEASURES ANOVA ON score by scaffold condition

#One way to look at this is an ANOVA on the difference score by scaffold condition
#construct contrasts for ANOVA model
options(contrasts=c("contr.sum","contr.poly"))

simpleModel = ezANOVA(data = df_subjects2,
                     dv = .(score_diff),
                     wid = .(subject),
                     between = .(condition),
                     type = 3,
                     detailed = TRUE)
simpleModel


pairwise.t.test(df_subjects2$score_diff, df_subjects2$condition,  p.adjust.method="bonferroni") 



```

Instead, we find that only in the interactive-image condition yields TM scores significantly higher than the no-scaffold control.  


###MIXED EFFECTS MODEL

*Compute mixed effects ANOVA on Response Score*   
Significant main effect of Graph     F(1,297) = 97.67, p < .001   
Significant main effect of Scaffold  F(4,297) = 4.24, p < .01    
Significant main effect of Scenario  F(1,297) = 22.29, p < .001   
Significant interaction of Scaffold and Graph F(4,297) = 9.99, p <.001   
Significant interaction of Graph and Scenario F(1,297) = 34.80, p <.001   

```{r} 

#construct contrasts for ANOVA model
options(contrasts=c("contr.sum","contr.poly"))

#execute the model
mixedModel = ezANOVA(data = l_scores,
                     dv = .(value),
                     wid = .(subject),
                     between = .(condition,order,lm_scenarios),
                     within = .(variable),
                     type = 3,
                     detailed = TRUE)
mixedModel
#summary(mixedModel)
```


####MAIN EFFECT: Graph on SCORE   
On average, participants scored significantly higher on the linear model task (M = 10.96, SD = 2.13) than on the triangular model (M = 8.78 SD = 4.44), t(316) = 9.41, p < 0.001, r = 0.47

```{r} 
bar <- ggplot(l_scores, aes(x = variable, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task ", y= "Score", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("linear_score" = "Linear Graph (LM)", "triangular_score" = "Triangular Graph (TM)")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Graph Task")+
      scale_fill_manual(values = c(green,red),
                        name = "Graph Task",
                        breaks =c("linear_score", "triangular_score"),
                        labels =c("linear","triangular"))
      
```

```{r}
#CALULCULATE POSTHOC DIFFERENCE & EFFECT SIZE
mainEffectGraph  <- t.test(value ~ variable, data=l_scores, paired=TRUE)
mainEffectGraph

t <-mainEffectGraph$statistic[[1]]
df <-mainEffectGraph$parameter[[1]]
r <- sqrt(t^2/(t^2+df))
round(r,3)
```

####MAIN EFFECT: Scaffold on SCORE
####MAIN EFFECT: Scenario on SCORE

When answering questions (with either graph) in the axis scenario (M = 9.20, SD = 4.12), participants had significantly lower scores, t(316) = -4.77, p < 0.001, r = -.26, than in the longmire scenario (M = 10.52, SD = 2.97)

```{r collapse = TRUE}
#RUN ANCOVA ON tm_score with lm_score as covariate
# model.1=aov(triangular_score~linear_score+condition, data=df_subjects2)
# 
# Anova(model.1, type="III") 
#ANCOVA PRECONDITIONS
#1. linear relationship between covariate and dependent variable
#2. all treatment (condition) regression lines have same slope 
test<-lm(formula = triangular_score ~ linear_score + condition,  data = df_subjects2)
summary(test)
```



```{r} 
bar <- ggplot(l_scores, aes(x = variable, y= value, fill=lm_scenarios))
bar + stat_summary(aes(y = value, group=lm_scenarios), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task", y= "Score", fill="") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("linear_score" = "linear (LM)", "triangular_score" = "triangular (TM)")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Scenario & Graph")+
      scale_fill_manual(values = c(blue,purple),
                        name = "Task Scenario",
                        breaks =c("axis","longmire"),
                        labels =c("axis","longmire"))
      
```

```{r} 
dots <- ggplot(l_scores, aes(x = lm_scenarios, y= value, color=variable))
dots + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="point", position = position_dodge(width=0.1),width=0.2) +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.1),width=0.2) +
      stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="line", position=position_dodge(width=0.1)) +
      labs (x = "Task Scenario ", y= "Score", fill="Task Graph") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("axis" = "axis", "longmire" = "longmire")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Scenario & Graph")+
      scale_color_manual(values = c(green,red),
                        name = "Task Graph",
                        breaks =c("linear_score", "triangular_score"),
                        labels =c("linear (LM)","triangular (TM)"))
      
```

```{r echo = FALSE}
# #CALULCULATE POSTHOC DIFFERENCE & EFFECT SIZE
# mainEffectGraph  <- t.test(value ~ lm_scenarios, data=l_scores, paired=TRUE, na.rm=TRUE)
# mainEffectGraph
# 
# t <-mainEffectGraph$statistic[[1]]
# df <-mainEffectGraph$parameter[[1]]
# r <- sqrt(t^2/(t^2+df))
# round(r,3)
```

####INTERACTION: Scaffold & Graph   
####INTERACTION: Scenario & Graph   
 

## Results (Time)
```{r echo = FALSE}
#SETUP DATA FOR RESPONSE TIME ANALYSIS
# our data df_subjects2 is in wide format (repeated measures in different columns), however we need it in long format
w_times = subset(df_subjects2, select = c("subject","condition", "order", "lm_scenarios", "LM_T_M","TM_T_M")) #create a wide form subset 
l_times <-melt(w_times, id=c("subject","condition", "order", "lm_scenarios"), measured=c("LM_T_M","TM_T_M")) 

#convert other variables to factors
l_times$condition <- factor(l_times$condition)
l_times$order <- factor(l_times$order)
l_times$lm_scenarios <- factor(l_times$lm_scenarios)
levels(l_times$condition)[levels(l_times$condition)=="0"] <- "control"
levels(l_times$condition)[levels(l_times$condition)=="1"] <- "wtext"
levels(l_times$condition)[levels(l_times$condition)=="2"] <- "htext"
levels(l_times$condition)[levels(l_times$condition)=="3"] <- "simage"
levels(l_times$condition)[levels(l_times$condition)=="4"] <- "ximage"
l_times$scaffold <-l_times$condition
```

####Explore the data
*We see comparable response times for LM and TM graphs when the LM graph is solved first.  However, when the TM graph is solved first, the TM graph-reading task seems to take much longer.*

```{r}
#EXPLORE THE DATA

#SIMPLE BOXPLOT BY CONDITION
# mixedPlot_condition <- ggplot(l_times, aes(condition,value, color=variable))+ geom_boxplot() +
#  labs(x="scaffold condition", y="time (mins)") +
#  ggtitle("Response Time by Scaffold ") +
#  theme_bw()
# mixedPlot_condition
  
#BOXPLOT BY CONDITION, FACET WITH ORDER
mixedPlot_order <- ggplot(l_times, aes(condition,value, fill=variable))+ geom_boxplot() +
  facet_wrap(~order, labeller=labeller(order = order_labels)) +
  labs(x="scaffold condition", y="time (mins)", color="task")+ 
  labs(title="Response Time by Scaffold & Graph-Order ") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_fill_manual( values = c(green,red),
                       name="graphing task",
                       breaks=c("LM_T_M", "TM_T_M"),
                       labels=c("linear", "triangular")) 
mixedPlot_order

#BOXPLOT BY CONDITION, FACET WITH ORDER AND SCENARIO
mixedPlot_scenario <- ggplot(l_times, aes(condition,value, fill=variable))+ geom_boxplot() +
 facet_grid(lm_scenarios~order, labeller=labeller(order = order_labels)) +
 labs(x="scaffold condition", y="time (mins)")+
 ggtitle("Response Time by Scaffold, Task Order and Scenario ") +
 theme_bw() +
 theme(strip.background = element_blank()) +
 scale_fill_manual( values = c(green,red),
                       name="graphing task",
                       breaks=c("LM_T_M", "TM_T_M"),
                       labels=c("linear", "triangular"))
mixedPlot_scenario
```


####Hypothesis Testing

*Compute mixed effects ANOVA on Response Time*   
Significant main-effect of Graph F(1,297) = 109.71, p <.001   
Significant interaction between Graph & Scaffold F(4,297) = 3.51, p < .01   
Significant interaction between Graph and Scenario, F(1,297) = 8.35, p <.01   
Significant interaction between Graph and Graph-Order, F(1,297) = 44.24, p <.001   

```{r} 

#construct contrasts for ANOVA model
options(contrasts=c("contr.sum","contr.poly"))

#execute the model
mixedModel = ezANOVA(data = l_times,
                     dv = .(value),
                     wid = .(subject),
                     between = .(condition,order,lm_scenarios),
                     within = .(variable),
                     type = 3,
                     detailed = TRUE)
mixedModel
#summary(mixedModel)
```


####MAIN EFFECT: Graph on TIME   
On average, participants spent significantly more time on triangular model task (M = 10.84, SD = 3.28) than on the linear model (M = 9.20, SD = 2.53), t(316) = -9.46, p < 0.001, r = 0.47

```{r echo = FALSE } 
bar <- ggplot(l_times, aes(x = variable, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task ", y= "Response Time (minutes)", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("LM_T_M" = "Linear Graph (LM)", "TM_T_M" = "Triangular Graph (TM)")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Response Time by Graph Task")+
      scale_fill_manual(values = c(green,red),
                        name = "Graph Task",
                        breaks =c("LM_T_M", "TM_T_M"),
                        labels =c("linear","triangular"))
```

```{r echo = FALSE}
#CALULCULATE POSTHOC DIFFERENCE & EFFECT SIZE
mainEffectGraph  <- t.test(value ~ variable, data=l_times, paired=TRUE)
mainEffectGraph

t <-mainEffectGraph$statistic[[1]]
df <-mainEffectGraph$parameter[[1]]
r <- sqrt(t^2/(t^2+df))
round(r,3)
```


####INTERACTION: Scaffold & Graph   
####INTERACTION: Scenario & Graph   
####INTERACTION: Order & Graph   

## Results (Graph Drawing) 

```{r collapse=TRUE}
# #explore independence of graph drawing by condition
# table(df_subjects2$`Graph Type`, df_subjects2$condition)
# chisq.test(df_subjects2$`Graph Type`, df_subjects2$condition, correct=TRUE) 
# fisher.test(df_subjects2$`Graph Type`, df_subjects2$condition) 
# 
# Input =("
# Interpretation control  whattext howtext static interactive
# 'Right angle'    17  6  9 10  2
# 'Triangular'    34 50 48 41 57
# 'Linear'        6  0  3  7  1
# 'Scatterplot'      0  0  0  0  0
# 'Asymmetric'      3  3  5  4  7
# ")
# 
# Matriz = as.matrix(read.table(textConnection(Input),
#                    header=TRUE, 
#                    row.names=1))
# 
# Matriz
# 
# chisq.test(Matriz)
# 
# pairwiseNominalIndependence(Matriz,
#                             fisher = FALSE,
#                             gtest  = FALSE,
#                             chisq  = TRUE,
#                             method = "fdr")
# 
# 
# FUN = function(i,j){     
#       chisq.test(matrix(c(Matriz[i,1], Matriz[i,2],
#                           Matriz[j,1], Matriz[j,2]),
#                  nrow=2,
#                  byrow=TRUE))$ p.value
#                 }
#       
# pairwise.table(FUN,
#                rownames(Matriz),
#                p.adjust.method="none")

```

```{r collapse = TRUE}
#explore independence of graph drawing by order
table(df_subjects2$`Graph Type`, df_subjects2$order)
chisq.test(df_subjects2$`Graph Type`, df_subjects2$order, correct=TRUE) 
fisher.test(df_subjects2$`Graph Type`, df_subjects2$order) 
# ftable(bigTable)
```

The cell sizes are too heterogeneous to look for correlations in TM score and drawing type, but we can directly compare the TM scores for the two triangular interpretations: the right-angle triangle and asymetric triangle.

```{r collapse = TRUE}

#SETUP DATA FOR RESPONSE ACCURACY ANALYSIS
df_small_draw <- subset(df_subjects2, df_subjects2$`Graph Type`%in% c("Triangular (asymmetric)","Triangular (right angle)"))
 
#LM SCORES BY SCAFFOLD
desc_control <- by(df_small_draw$triangular_score, df_small_draw$`Graph Type`, stat.desc, basic=FALSE)
desc_control

right_mean = desc_control$`Triangular (right angle)`[2]
right_SD = desc_control$`Triangular (right angle)`[6]
asy_mean = desc_control$`Triangular (asymmetric)`[2]
asy_SD = desc_control$`Triangular (asymmetric)`[6]

# #CALULCULATE POSTHOC DIFFERENCE & EFFECT SIZE
mainEffectGraph  <- t.test(triangular_score ~ `Graph Type`, data=df_small_draw, na.rm=TRUE)
mainEffectGraph

t <-mainEffectGraph$statistic[[1]]
df <-mainEffectGraph$parameter[[1]]
r <- sqrt(t^2/(t^2+df))
round(r,3)
```

TM scores for participants who drew "right-angle" graphs were significantly lower (M = `r round(right_mean,2)`, SD = `r round(right_SD,2)`) than for participants who drew "asymmetric triangle" graphs (M = `r round(asy_mean,2)`, SD = `r round(asy_SD,2)`), t(`r df`) = `r t`, p = `r p[[1]]` , r = `r r`. 

<!--html_preserve--><a href="static/Study2/gallery/analysis.html">See GALLERY of all images here</a><!--/html_preserve-->


## References

Qiang, Y., Valcke, M., De Maeyer, P., & Van de Weghe, N. (2014). Representing time intervals in a two-dimensional space: An empirical study. Journal of Visual Languages and Computing, 25(4), 466–480. 








## Power Analyses
In order to estimate the number of subjects needed for future study, we will evaluate the statistical significance and effect size of any differences in accuracy scores between scaffold groups for the TM-graph only, in the TM-first graph order. 


```{r collapse=TRUE}
#explore descriptive statistics based on each IV
desc <- by(df_subjects2$triangular_score, list(df_subjects2$condition), stat.desc, basic=FALSE)
desc
# LM_mean = desc_control$linear_score[2]
# LM_SD = desc_control$linear_score[6]
# TM_mean = desc_control$triangular_score[2]
# TM_SD = desc_control$triangular_score[6]
```



```{r} 
bar <- ggplot(df_subjects2, aes(x = condition, y= triangular_score))
bar + stat_summary(aes(y = triangular_score, group=condition), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Scaffold", y= "Score Difference (TM-LM)") +
      coord_cartesian(ylim=c(0,15)) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("TM Score by Scaffold for TM-first Order ") +
      scale_x_discrete(labels=c( "0" = "none-control", "1" = "what-text", "2"="how-text", "3"="static-img", "4"="ix img")) 

```


```{r}
#ONE WAY ANOVA ON triangular score BY SCAFFOLD
#construct contrasts for ANOVA model
options(contrasts=c("contr.sum","contr.poly"))

simpleModel = ezANOVA(data = w_scores,
                     dv = .(triangular_score),
                     wid = .(subject),
                     between = .(condition),
                     type = 3,
                    detailed = TRUE)
simpleModel$ANOVA
```
the GES is the (generalized eta squared)

Eta-square (η2) is an effect size measurement for the analysis of variance (ANOVA). It measures the strength of the effect on a continuous field.
The effect can be the main effect of one field or the interaction effect of two fields.
Eta-square can be interpreted as the proportion of variance in the continuous target field explained by an effect while controlling for other effects. It is calculated by dividing the sum of squares for the effect by the total sum of squares.
Table 1. Interpretation of effect size when there is one input (One-way ANOVA)
Effect size (ES)	Interpretation
ES ≤ 0.04	The effect is statistically significant but weak.
0.04 < ES ≤ 0.36	The effect is moderate.
ES > 0.36	The effect is strong.