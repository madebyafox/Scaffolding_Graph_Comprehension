---
title: "2YP - FOX - Analysis "
output: html_notebook
---

```{r echo = FALSE}
#import necessary packages
library(readr) #load csv
library(pastecs) #stat.desc
library(tables) # pretty tables
library(dplyr) #data formatting
library(ez) #mixed anova
library(reshape2) #reformatting data
library(car)   #statistics
library(ggplot2) #graphs

#LOAD THE PARTICIPANT DATA
all_participants <- read_csv("~/Sites/RESEARCH/2YP-Analysis/xls-files/master-wrangled-data/all_participants.csv", 
    col_types = cols(ARF = col_skip(), Comments = col_skip(), 
        `Graph Description (if other)` = col_skip(), 
        `Graph Title` = col_skip(), `Graph Type` = col_factor(levels = c("Triangular (right angle)", 
            "Triangular", "Linear Model", 
            "Scatterplot", "Other", "Triangular (asymmetric)")), 
        Points = col_skip(), Rater = col_skip(), 
        `Select each item that is labelled in the graph` = col_skip(), 
        `X Axis` = col_skip(), `Y Axis` = col_skip(),
        GENDER = col_factor(levels = c("Male", 
        "Female","Other")),
        condition = col_factor(levels = c("0", 
            "1", "2", "3", "4")), d_t = col_skip(), 
        d_t_2 = col_skip(), experiment = col_factor(levels = c("experiment", 
            "reverse")), linear_time = col_skip(), 
        lm_scenarios = col_factor(levels = c("axis", 
            "longmire")), ls_t = col_skip(), 
        lt_t = col_skip(), time_diff = col_skip(), 
        tm_scenarios = col_factor(levels = c("longmire", 
            "axis")), triangular_time = col_skip(), 
        ts_t = col_skip(), tt_t = col_skip() ))

#LOAD THE EXPERT DATA
all_experts <- read_csv("~/Sites/RESEARCH/2YP-Analysis/xls-files/master-wrangled-data/all_experts.csv", 
    col_types = cols(
        condition = col_factor(levels = c("0", 
            "1", "2", "3", "4")), d_t = col_skip(), 
        d_t_2 = col_skip(), experiment = col_factor(levels = c("reverse", 
            "experiment")), linear_time = col_skip(), 
        lm_scenarios = col_factor(levels = c("axis", 
            "longmire")), ls_t = col_skip(), 
        lt_t = col_skip(), time_diff = col_skip(), 
        tm_scenarios = col_factor(levels = c("longmire", 
            "axis")), triangular_time = col_skip(), 
        ts_t = col_skip(), tt_t = col_skip()))

#SETUP DATA FRAMES
#create copy data of base data frame 
df_subjects <- cbind(all_participants)
df_experts <- cbind(all_experts)

#create a new column for order with better name
df_subjects$order = df_subjects$experiment
levels(df_subjects$order)[levels(df_subjects$order)=="experiment"] <- "LMFirst"
levels(df_subjects$order)[levels(df_subjects$order)=="reverse"] <- "TMFirst"

#create a column for the sum of the two graphing tasks (graphScore)
df_subjects$graphScore = df_subjects$linear_score + df_subjects$triangular_score

#create a column for the sum of the two drawing tasks (graphScore)
df_subjects$drawScore = df_subjects$points + df_subjects$d_n

#create data subsets
df_regular <- subset(df_subjects, experiment=="experiment")
df_reverse <- subset(df_subjects, experiment=="reverse")



#create subsets of runtimes
w_scores = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios", "tm_scenarios", "linear_score","triangular_score")) #create a wide form subset 
l_scores <-melt(w_scores, id=c("subject","condition", "order", "lm_scenarios","tm_scenarios"), measured=c("linear_score","triangular_score")) #create a longform version



#merge scenario to single contextual column
l_scores$scenario <- l_scores[4:5][cbind(seq_along(l_scores$variable), l_scores$variable)]
l_times$scenario <- l_scores[4:5][cbind(seq_along(l_scores$variable), l_scores$variable)]

# our data df_subjects is in wide format (repeated measures in different columns), however we need it in long format
w_times = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios","tm_scenarios", "LM_T_M","TM_T_M")) #create a wide form subset 
l_times <-melt(w_times, id=c("subject","condition", "order", "lm_scenarios","tm_scenarios"), measured=c("LM_T_M","TM_T_M")) 
l_times$scenario <- l_times[4:5][cbind(seq_along(l_times$variable), l_times$variable)]

#SETUP LABELS AND COLORS FOR GRAPHS
order_labels <- c(LMFirst = "linear-first", TMFirst = "triangular-first")
condition_lables <-c( '0' = "no scaffold", '1' = "what-text", '2' = "how-text", '3' = "static image", '4' = "interactive image")
task_labels <- c("LM_T_M" = "linear graph", "TM_T_M" = "triangular graph")

  red = "#F8766D"
  green = "#1cc07e"
  blue = "#59A1FC"
  purple = "#C680FD"
  none = "#7E7D7E"
  text1 = "#071FD5"
  text2 = "#0C91DF"
  img1 = "#EF007A"
  img2 = "#c481d5"


  


```

##Study TWO: ALL SUBJECTS
> RESPONSE ACCURACY

```{r echo = FALSE}

##construct MEANS PLOT 
line <- ggplot(df_subjects, aes(condition, score_diff)) 
line + coord_cartesian(ylim=c(-5,5)) +
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.y = mean, geom = "line", aes(group=1), color = "blue", linetype="dashed") + #the grouping line
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="scaffold condition", y="time (in minutes)") +
  ggtitle("TM Response Time Improvement by Scaffold Condition") +
  theme_bw()
```

```{r echo = FALSE}

DiffScoreBoxplot <-ggplot(df_subjects, aes(group=condition, x=condition,y=score_diff))
DiffScoreBoxplot + geom_boxplot() +
  coord_cartesian(ylim=c(-5,5)) +
  labs(x="scaffold condition", y="TM Time Improvement (minutes)")+
  ggtitle("Boxplot of TM Time Improvement") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  theme(panel.border = element_blank())
```

```{r echo = FALSE}

#compute and evaluate difference in response time
by(df_subjects$score_diff, df_subjects$condition, stat.desc)

#conduct levene test for homogonaeity of variance (should NOT be significant)
leveneTest(df_subjects$score_diff, df_subjects$condition, center=median)

exp_diffSCOREBYconditionModel <- aov(score_diff~condition, data = df_subjects)
summary(exp_diffSCOREBYconditionModel)
summary.lm(exp_diffSCOREBYconditionModel)
```
...1 way independent ANOVA is signficant at p < 0.001. F(4,477) = 7.67, p < 0.001. Multiple R-squared = eta-squared = 0.08959 = r-squared. Effect size r therefore = sqrt(0.08959) = 0.3 a medium effect.    NONE of the scaffold groups resulted in faster response times than the LM.  

```{r echo = FALSE}
TukeyHSD(exp_diffSCOREBYconditionModel, conf.level=.95) 
#plot(TukeyHSD(aov(df_subjects$score_diff~df_subjects$condition), conf.level=.95))
```
with p < 0.05
2 is greater than control
4 is greater than control
4 is greater than 1
4 is greater than 2
4 is greater than 3
---------------------
4 performed better than all other conditions
conditions 2 and 4 performed better than control


> RESPONSE TIME 

```{r echo = FALSE}

##construct MEANS PLOT 
line <- ggplot(df_subjects, aes(condition, DIFF_T_M)) 
line + coord_cartesian(ylim=c(-5,5)) +
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.y = mean, geom = "line", aes(group=1), color = "blue", linetype="dashed") + #the grouping line
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="scaffold condition", y="time (in minutes)") +
  ggtitle("TM Response Time Improvement by Scaffold Condition") +
  theme_bw()
```

```{r echo = FALSE}

DiffScoreBoxplot <-ggplot(df_subjects, aes(group=condition, x=condition,y=DIFF_T_M))
DiffScoreBoxplot + geom_boxplot() +
  coord_cartesian(ylim=c(-5,5)) +
  labs(x="scaffold condition", y="TM Time Improvement (minutes)")+
  ggtitle("Boxplot of TM Time Improvement") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  theme(panel.border = element_blank())
```

```{r echo = FALSE}

#compute and evaluate difference in response time
by(df_subjects$DIFF_T_M, df_subjects$condition, stat.desc)

#conduct levene test for homogonaeity of variance (should NOT be significant)
leveneTest(df_subjects$DIFF_T_M, df_subjects$condition, center=median)

exp_difftimeBYconditionModel <- aov(DIFF_T_M~condition, data = df_subjects)
summary(exp_difftimeBYconditionModel)
summary.lm(exp_difftimeBYconditionModel)
```
Levene's is not significant... 
...1 way independent ANOVA is signficant at p < 0.001. F(4,135) = 33.79, p = 0.006. Multiple R-squared = eta-squared = 0.0451 = r-squared. Effect size r therefore = sqrt(0.0451) = 0.212 a medium effect.    NONE of the scaffold groups resulted in faster response times than the LM.  

```{r echo = FALSE}
#post hoc Tukey tests
TukeyHSD(exp_difftimeBYconditionModel, conf.level=.95) 
#plot(TukeyHSD(aov(df_subjects$score_diff~df_subjects$condition), conf.level=.95))
```

for p < .05
2 greater than control
4 greater than control
4 greater than 1
4 greater than 2
4 greater than 3
------------------
4 significantly different from all 
2 and 4 significantly different from control