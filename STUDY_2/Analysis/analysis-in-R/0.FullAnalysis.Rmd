---
title: "2YP FOX"
output:
  html_notebook: default
  pdf_document: default
  word_document: default
---

```{r echo = FALSE}
#import necessary packages
library(readr) #load csv
library(pastecs) #stat.desc
library(tables) # pretty tables
library(dplyr) #data formatting
library(ez) #mixed anova
library(reshape2) #reformatting data
library(car)   #statistics
```

```{r echo = FALSE}
#LOAD THE PARTICIPANT DATA
all_participants <- read_csv("~/Sites/RESEARCH/2YP-Analysis/xls-files/master-wrangled-data/all_participants.csv", 
    col_types = cols(ARF = col_skip(), Comments = col_skip(), 
        `Graph Description (if other)` = col_skip(), 
        `Graph Title` = col_skip(), `Graph Type` = col_factor(levels = c("Triangular (right angle)", 
            "Triangular", "Linear Model", 
            "Scatterplot", "Other", "Triangular (asymmetric)")), 
        Points = col_skip(), Rater = col_skip(), 
        `Select each item that is labelled in the graph` = col_skip(), 
        `X Axis` = col_skip(), `Y Axis` = col_skip(),
        GENDER = col_factor(levels = c("Male", 
        "Female","Other")),
        condition = col_factor(levels = c("0", 
            "1", "2", "3", "4")), d_t = col_skip(), 
        d_t_2 = col_skip(), experiment = col_factor(levels = c("experiment", 
            "reverse")), linear_time = col_skip(), 
        lm_scenarios = col_factor(levels = c("axis", 
            "longmire")), ls_t = col_skip(), 
        lt_t = col_skip(), time_diff = col_skip(), 
        tm_scenarios = col_factor(levels = c("longmire", 
            "axis")), triangular_time = col_skip(), 
        ts_t = col_skip(), tt_t = col_skip() ))
#View(all_participants)

#LOAD THE EXPERT DATA
all_experts <- read_csv("~/Sites/RESEARCH/2YP-Analysis/xls-files/master-wrangled-data/all_experts.csv", 
    col_types = cols(
        condition = col_factor(levels = c("0", 
            "1", "2", "3", "4")), d_t = col_skip(), 
        d_t_2 = col_skip(), experiment = col_factor(levels = c("reverse", 
            "experiment")), linear_time = col_skip(), 
        lm_scenarios = col_factor(levels = c("axis", 
            "longmire")), ls_t = col_skip(), 
        lt_t = col_skip(), time_diff = col_skip(), 
        tm_scenarios = col_factor(levels = c("longmire", 
            "axis")), triangular_time = col_skip(), 
        ts_t = col_skip(), tt_t = col_skip()))

```

```{r echo = FALSE}
#SETUP LABELS AND COLORS FOR GRAPHS
order_labels <- c(LMFirst = "linear-first", TMFirst = "triangular-first")
condition_lables <-c( '0' = "no scaffold", '1' = "what-text", '2' = "how-text", '3' = "static image", '4' = "interactive image")
task_labels <- c("LM_T_M" = "linear graph", "TM_T_M" = "triangular graph")

  red = "#F8766D"
  green = "#1cc07e"
  blue = "#59A1FC"
  purple = "#C680FD"
  none = "#7E7D7E"
  text1 = "#071FD5"
  text2 = "#0C91DF"
  img1 = "#EF007A"
  img2 = "#c481d5"

```

```{r echo = FALSE}
#SETUP DATA FRAMES
#create copy data of base data frame 
df_subjects <- cbind(all_participants)
df_experts <- cbind(all_experts)

#create a new column for order with better name
df_subjects$order = df_subjects$experiment
levels(df_subjects$order)[levels(df_subjects$order)=="experiment"] <- "LMFirst"
levels(df_subjects$order)[levels(df_subjects$order)=="reverse"] <- "TMFirst"

#create a column for the sum of the two graphing tasks (graphScore)
df_subjects$graphScore = df_subjects$linear_score + df_subjects$triangular_score

#create a column for the sum of the two drawing tasks (graphScore)
df_subjects$drawScore = df_subjects$points + df_subjects$d_n

#create data subsets
df_regular <- subset(df_subjects, experiment=="experiment")
df_reverse <- subset(df_subjects, experiment=="reverse")
```

### METHODS
```{r echo = FALSE}
#EXPLORE SAMPLE STATISTICS

#record sample size
nSubjects = nrow(df_subjects)
nExperts = nrow(df_experts)
n = nSubjects + nExperts
nReg = nrow(df_regular)
nRev = nrow(df_reverse)

#how many women?
nFemale <-nrow(filter(df_subjects, df_subjects$GENDER == 'Female'))

#describe the sample
descriptives<-stat.desc(df_subjects)
#descriptives

#determine age range
age_min = descriptives$AGE[4]
age_max = descriptives$AGE[5]
age_m = round(descriptives$AGE[9], 2)
age_sd = round(descriptives$AGE[10], 2)


time_min = round(descriptives$TOTAL_T_M[4], 0)
time_max = round(descriptives$TOTAL_T_M[5], 0)
time_m = round(descriptives$TOTAL_T_M[9], 0)
time_sd = round(descriptives$TOTAL_T_M[10], 2)
```
####1. Participants   
`r nSubjects` (`r round(nFemale/nSubjects,2) * 100`% female) English speakers aged `r age_min` to `r age_max` were recruited from the experimental-subject pool at a large public university in the United States (M(age) = `r age_m`, SD(age) = `r age_sd`). Participants completed three activities: two graph reading tasks followed by a drawing task. In some cases (order = linear-first), participants (n = `r nReg`) completed the first graph reading task with a linear model graph, followed by the task with the triangular graph. To control for any effects of graph order on performance, an additional (n= `r nRev`) subjects completed the activities with the graphs in reverse order. Each participant was randomly assigned to one of five conditions which determined what additional information (scaffold) they received while solving the first five problems on each graph reading task: no-scaffold (control), 'what' text, 'how'-text, static-image, interactive-image. The runtime of the entire study ranged from `r time_min` to `r time_max` minutes (M = `r time_m`, SD = `r time_sd`).    

In addition, we ran `r nExperts` expert participants through two conditions, composed of research assistants with more than 20 hours of experience analyzing data with the triangular model graph.   


```{r results = 'asis', echo = FALSE}
#create table of participants numbers by experiment and condition
#ORDER <- factor(df_subjects$order)
#CONDITION <- factor(df_subjects$condition)
#table <- tabular(  (CONDITION+1)~(ORDER+1), data = df_subjects )
#table_options(rowlabeljustification="center", justification="right")
#table
#html(table,options=htmloptions(head=TRUE))
```   

####2. Results: Response Latency
#####Explore the data 
```{r echo = FALSE}
# create a subset dataframe that only deals with response times 
#create subsets of runtimes
w_times = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios", "LM_T_M","TM_T_M")) #create a wide form subset 
l_times <-melt(w_times, id=c("subject","condition", "order", "lm_scenarios"), measured=c("LM_T_M","TM_T_M")) #create a longform version
```

```{r results = 'asis', echo = FALSE}
#Create a tables of means for task runtime 

CONDITION <- factor(w_times$condition)
table = tabular (CONDITION + 1~ Format(digits=2)* 
                   (Heading (Linear)*LM_T_M + Heading(Triangular)*TM_T_M) * (mean + sd), data = w_times)
table

table = tabular (1~ Format(digits=2)* 
                   (Heading (Linear)*LM_T_M + Heading(Triangular)*TM_T_M) * (mean + sd), data = df_experts)
table


#html(table,options=htmloptions(head=TRUE))
#latex(table)
```

#####Construct a mixed effects ANOVA
1. Explore descriptives for each factor 
```{r echo = FALSE}
#explore descriptive statistics based on each IV
#by(l_times$value, list(l_times$condition, l_times$order, l_times$variable), stat.desc, basic=FALSE)
```
2. Construct contrasts
```{r echo = FALSE}
#construct contrasts for ANOVA model
lmVStm <-c(-1,1)
contrasts(l_times$variable) <- cbind(lmVStm)
expVSrev<-c(-1,1)
contrasts(l_times$order) <- cbind(lmVStm)
scaffVSold<-c(1,0,0,0,1)
contrasts(l_times$condition) <- cbind(scaffVSold)
```
3. compute the ANOVA model
```{r echo = FALSE}

options(contrasts=c("contr.sum","contr.poly"))

#execute the model
times.mixedModel = ezANOVA(data = l_times,
                     dv = .(value),
                     wid = .(subject),
                     between = .(condition,order,lm_scenarios),
                     within = .(variable),
                     type = 3,
                     detailed = FALSE)
times.mixedModel
```
RESULTS OF MIXED EFFECTS ANOVA ON RESPONSE TIME suggest...
xx significant main-effect of graph task F(1,297) = 110.67, p <.001
xx significant interaction between graph & scaffold F(4,297) = 3.48, p < .001
xx significant interaction between graph and order, F(1,297) = 44.20, p <.001
xx significant interaction between graph and scenario, F(1,297) = 8.28, p <.001

All effects are reported significant at p < .001.  There was a significant main effect of graph-type, F(1,297) = 70.72,  There were significant interaction effects for the graph-type and the scaffold condition, F(4,297) = 3.48, the graph-type and graph-order, F(1,297) = 31.37, and graph-type and scenario, F(1,297) = 10.4.  The three-way interaction of graph-type, scaffold condition and graph-order approached significance at F(4,297) = 2.23, p = 0.06

4. Interpret significant effects   
`Main Effect: Graph Type`
```{r echo = FALSE } 
bar <- ggplot(l_times, aes(x = variable, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task", y= "Response Time (minutes)", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("TM_T_M" = "Triangular Model", "LM_T_M" = "Linear Model")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Response Time by Graph Task")+
      scale_fill_manual(values = c(green,red),
                        breaks =c("LM_T_M", "TM_T_M"),
                        labels =c("linear","triangular"))
      
```
Across all scaffold conditions, participants spent on average 9.2 minutes on the linear model task, and 10.8 minutes on the triangular model task. The significant main effect of graph type suggests that the full range of scaffold techniques were not effective enough, on the whole, to realize the potential performance gains with the Triangular Model suggested in [CITE QIANG ET AL]. 

`IXN Graph Type & Scaffold`
There was a significant interaction between graph-type and the scaffold condition, 

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME 
MP_times <- ggplot(l_times, aes(x = condition, y=value, color=variable)) +
  scale_colour_manual(values = c(green, red),
                      breaks = c("TM_T_M", "LM_T_M"),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("0" = "none", "1" = "what-text",
                              "2" = "how-text", "3"="static image", "4"="interactive image"))

MP_times + 
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point", position=position_dodge(width=0.2)) +  #the point with dodge 
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .2, position=position_dodge(width=0.2)) + #the errorbar with dodge
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Response Time (minutes)", color="Graph Task") +
  ggtitle("Mean Response Time by Scaffold and Graph Task") +
  theme_bw() +
  theme(strip.background = element_blank())
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  #stat_summary(fun.y = mean, geom = "point") +  #the point, with no position dodge
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) + #error bars no dodge

```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_times <- ggplot(l_times, aes(x = variable, y=value, color=condition)) 

MP_times + 
  stat_summary(aes(y = value,group=condition), fun.y=mean,  geom="line") + #, position=position_dodge(width=0.2)) +
  coord_cartesian(ylim=c(8,13)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  #stat_summary(fun.y = mean, geom = "point", position=position_dodge(width=0.2)) +  #the point with dodge 
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .2, position=position_dodge(width=0.2)) + #the errorbar with dodge
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Task ", y="Response Time (minutes)", color="Scaffold") +
  ggtitle("Mean Response Time by Scaffold and Graph Task") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("TM_T_M" = "triangular", "LM_T_M" = "linear"))+
  scale_color_manual(values = c("black",text1,text2,img1,img2),
                       name="Scaffold ",
                       breaks=c("0", "1","2","3","4"),
                       labels=c("none","what-text","how-text","static image","interactive image"))

```


`IXN Graph Type & Order`
There was a significant interaction between graph-type and graph-order, 
```{r echo = FALSE } 
bar <- ggplot(l_times, aes(x = order, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Order", y= "Response Time (minutes)", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("LMFirst" = "Linear-Triangular", "TMFirst" = "Triangular-Linear")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Response Time by Graph Order and Task")+
      scale_fill_manual(values = c(green,red),
                        name = "Graph Task",
                        breaks =c("LM_T_M", "TM_T_M"),
                        labels =c("linear","triangular"))
      
```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_times <- ggplot(l_times, aes(x = variable, y=value, color=order)) 

MP_times + 
  stat_summary(aes(y = value,group=order), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Task ", y="Response Time (minutes)") +
  ggtitle("Mean Response Time by Graph Order and Graph Task") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("TM_T_M" = "triangular", "LM_T_M" = "linear"))+
  scale_color_manual(values = c("black","red"),
                       name="Graph Order ",
                       breaks=c("TMFirst", "LMFirst"),
                       labels=c("triangular-first","linear-first"))
```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_times <- ggplot(l_times, aes(x = order, y=value, color=variable)) 

MP_times + 
  stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Order ", y="Response Time (minutes)") +
  ggtitle("Mean Response Time by Graph Order and Graph Type") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("LMFirst" = "linear-first", "TMFirst" = "triangular-first"))+
  scale_color_manual(values = c(green,red),
                       name="Graph Type",
                       breaks=c("LM_T_M", "TM_T_M"),
                       labels=c("linear","triangular"))
```

`IXN Graph Type & Scenario`
There was a significant interaction between graph-type and scenario
```{r echo = FALSE } 
bar <- ggplot(l_times, aes(x = variable, y= value, fill=lm_scenarios))
bar + stat_summary(aes(y = value, group=lm_scenarios), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task", y= "Response Time (minutes)", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("TM_T_M" = "Triangular Model", "LM_T_M" = "Linear Model")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Response Time by Graph Task and Scenario")+
      scale_fill_manual(values = c(purple,blue),
                        name = "Scenario",
                        breaks =c("axis", "longmire"),
                        labels =c("axis","longmire"))
      
```

```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_times <- ggplot(l_times, aes(x = variable, y=value, color=lm_scenarios)) 

MP_times + 
  stat_summary(aes(y = value,group=lm_scenarios), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Type ", y="Response Time (minutes)") +
  ggtitle("Mean Response Time by Scenario Order and Graph Type") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("TM_T_M" = "triangular", "LM_T_M" = "linear"))+
  scale_color_manual(values = c(purple,blue),
                       name="Scenario Order",
                       breaks=c("axis", "longmire"),
                       labels=c("tasks-events","events-tasks"))
```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_times <- ggplot(l_times, aes(x = lm_scenarios, y=value, color=variable)) 

MP_times + 
  stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scenario Order ", y="Response Time (minutes)") +
  ggtitle("Mean Response Time by Scenario Order and Graph Type") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("axis" = "tasks-events", "longmire" = "events-tasks"))+
  scale_color_manual(values = c(green,red),
                       name="Graph Type",
                       breaks=c("LM_T_M", "TM_T_M"),
                       labels=c("linear","triangular"))
```
`IXN Graph Type & Order & Scenario`
The three-way interaction of graph-type, scaffold condition and graph-order approached significance at F(4,297) = 2.23, p = 0.06.

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
MP_times <- ggplot(l_times, aes(x = condition, y=value, color=variable,  shape=variable)) +
    scale_shape_manual(values=c(15, 17)) +
  scale_colour_manual(values = c(green, red),
                      breaks = c("TM_T_M", "LM_T_M"),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("0" = "none", "1" = "what-text",
                              "2" = "how-text", "3"="static img", "4"="ix img"))

MP_times + facet_wrap(~order ,labeller=labeller(order = order_labels) ) +
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  #stat_summary(fun.y = mean, geom = "point") +  #the point
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  stat_summary(fun.y = mean, geom = "point", position=position_dodge(width=0.2)) +  #the point with dodge 
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .2, position=position_dodge(width=0.2)) + #the errorbar with dodge
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold", y="Response Time (minutes)", color="Graph Type") +
  ggtitle("Mean Response Time by Graph, Scaffold and Task Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
MP_times <- ggplot(l_times, aes(x = order, y=value, color=variable)) +
  scale_colour_manual(values = c(red, green),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("LMFirst" = "linear-first", "TMFirst" = "triangular-first"))

MP_times + facet_wrap(~condition ,labeller=labeller(condition = condition_lables) ) +
  stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Response Time (minutes)", color="Graph Type") +
  ggtitle("Mean Response Time by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

####2. Results: Response Accuracy
```{r echo = FALSE}
# create a subset dataframe that only deals with response times 
#create subsets of runtimes
w_scores = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios", "linear_score","triangular_score")) #create a wide form subset 
l_scores <-melt(w_scores, id=c("subject","condition", "order", "lm_scenarios"), measured=c("linear_score","triangular_score")) #create a longform version
```

```{r results = 'asis', echo = FALSE}
#Create a tables of means for task runtime 

table = tabular (condition +1 ~ Format(digits=2)* 
                   (Heading (Linear)*linear_score + Heading(Triangular)*triangular_score) * (mean + sd), data = w_scores)
table
#html(table,options=htmloptions(head=TRUE))
#latex(table)
```

#####Construct a mixed ANOVA
1. Explore descriptives for each factor 
```{r echo = FALSE}
#explore descriptive statistics based on each IV
#by(l_scores$value, list(l_scores$condition, l_times$order, l_times$variable), stat.desc, basic=FALSE)
```
2. Construct contrasts
```{r echo = FALSE}
#construct contrasts for ANOVA model
lmVStm <-c(1,-1)
contrasts(l_scores$variable) <- cbind(lmVStm)
expVSrev<-c(1,-1)
contrasts(l_scores$order) <- cbind(lmVStm)
scaffVSold<-c(-1,0,0,0,1)
contrasts(l_scores$condition) <- cbind(scaffVSold)
```
3. compute the ANOVA model
```{r echo = FALSE}

options(contrasts=c("contr.sum","contr.poly"))

#execute the model
scores.mixedModel = ezANOVA(data = l_scores,
                     dv = .(value),
                     wid = .(subject),
                     between = .(condition,order,lm_scenarios),
                     within = .(variable),
                     type = 3,
                     detailed = FALSE)
scores.mixedModel
```
MIXED EFFECTS ANOVA ON SCORE 
Main effect of Scaffold  F(4,297) = 4.31, p < .01
Main effect of Scenario  F(1,297) = 22.29, p < .001
Main effect of Graph     F(1,297) = 97.67, p < .001
Interaction of Scaffold and Graph F(4,297) = 9.99, p <.001
Interaction of Graph and Scenario F(1,297) = 34.80, p <.001


All effects are reported significant at p < .001.  There were significant main effects of condition, F(4,297) = 4.31, scenario, F(1,297) = 22.29, and graph-type, F(1,297) = 97.67,  There were significant interaction effects for the graph-type and the scaffold condition, F(4,297) = 9.99, the graph-type and scenario, F(1,297) = 34.80.  The three-way interaction of graph-type, scaffold condition and graph-order approached significance at F(4,297) = 2.03, p = 0.08

4. Interpret significant effects   
`Main Effect: Graph Type`
```{r echo = FALSE } 
bar <- ggplot(l_scores, aes(x = variable, y= value, fill=variable))
bar + stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task", y= "Score", fill ="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("linear_score" = "Linear Model", "triangular_score" = "Triangular Model")) +
      scale_colour_manual(values = c(red, green),
                      labels = c("triangular","linear"))+
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Graph Task") +
      scale_fill_manual( values = c(green,red),
                         breaks = c("triangular_score", "linear_score"),
                         labels = c("triangular","linear"))
```
`Main Effect of Scaffold : superceded by interaction`
```{r echo = FALSE } 
bar <- ggplot(l_scores, aes(x = condition, y= value, fill=condition))
bar + stat_summary(aes(y = value), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Scaffold", y= "Score", fill="Scaffold") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("none", "what-text", "how-text" , "static image", "interactive image")) +
      scale_fill_manual(values = c(none, text1, text2,img1,img2),
                      labels = c("none","what-text","how-text","static image", "interactive image"))+
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Scaffold") 
      
```
`Main Effect of Scenario : superceded by interaction`
```{r echo = FALSE } 
bar <- ggplot(l_scores, aes(x = lm_scenarios, y= value))
bar + stat_summary(aes(y = value), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Scenario Order", y= "Score", fill="Scenario Order") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("axis" = "tasks-events" , "longmire"="events-tasks")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Scenario Order") 
      
```

`IXN Graph Type & Scaffold`
There was a significant interaction between graph-type and the scaffold condition, 
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_scores <- ggplot(l_scores, aes(x = variable, y=value, color=condition)) 

MP_scores + 
  stat_summary(aes(y = value,group=condition), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Task ", y="Score") +
  ggtitle("Mean Score by Scaffold and Graph Task") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("triangular_score" = "triangular", "linear_score" = "linear"))+
  scale_color_manual(values = c("black",text1,text2,img1,img2),
                       name="Scaffold ",
                       breaks=c("0", "1","2","3","4"),
                       labels=c("none","what-text","how-text","static image","interactive image"))
```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_scores <- ggplot(l_scores, aes(x = condition, y=value, color=variable)) 

MP_scores + 
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  #stat_summary(fun.y = mean, geom = "point") +  #the point
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  stat_summary(fun.y = mean, geom = "point", position=position_dodge(0.2)) +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1, position=position_dodge(0.2)) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold", y="Score") +
  ggtitle("Mean Score by Scaffold and Graph Task") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("none","what-text","how-text","static image","interactive image"))+
  scale_color_manual(values = c(green,red),
                       name="Graph Task",
                       breaks=c("triangular_score", "linear_score"),
                       labels=c("triangular", "linear"))
```


`IXN Graph Type & Scenario`
There was a significant interaction between graph-type and scenario

```{r echo = FALSE } 
bar <- ggplot(l_scores, aes(x = variable, y= value, fill=lm_scenarios))
bar + stat_summary(aes(y = value, group=lm_scenarios), fun.y=mean,  geom="bar", position="dodge") +
      stat_summary(fun.data = mean_cl_normal, geom="errorbar", position = position_dodge(width=0.9),width=0.2) +
      labs (x = "Graph Task", y= "Score", fill="Graph Task") +
      coord_cartesian(ylim=c(0,15)) +
      scale_x_discrete(labels=c("triangular_score" = "Triangular Model", "linear_score" = "Linear Model")) +
      theme_bw() +
      theme(strip.background = element_blank()) +
      ggtitle("Mean Score by Graph Task and Scenario")+
      scale_fill_manual(values = c(purple,blue),
                        name = "Scenario",
                        breaks =c("axis", "longmire"),
                        labels =c("axis","longmire"))
      
```

```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_scores <- ggplot(l_scores, aes(x = variable, y=value, color=lm_scenarios)) 

MP_scores + 
  stat_summary(aes(y = value,group=lm_scenarios), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Graph Type ", y="Score") +
  ggtitle("Mean Score by Scenario Order and Graph Type") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("triangular_score" = "triangular", "linear_score" = "linear"))+
  scale_color_manual(values = c(blue,purple),
                       name="Scenario",
                       breaks=c("axis", "longmire"),
                       labels=c("axis","longmire"))
```
```{r echo = FALSE}
#construct MEANS PLOT of TIME
MP_scores <- ggplot(l_scores, aes(x = lm_scenarios, y=value, color=variable)) 

MP_scores + 
  stat_summary(aes(y = value, group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scenario Order ", y="Score") +
  ggtitle("Mean Score by Scenario Order and Graph Type") +
  theme_bw() +
  theme(strip.background = element_blank()) +
  scale_x_discrete(labels=c("axis" = "tasks-events", "longmire" = "events-tasks")) +
  scale_color_manual(values = c(green,red),
                       name="Graph Type",
                       breaks=c("linear_score", "triangular_score"),
                       labels=c("linear","triangular"))
```
`IXN Graph Type & Condition & Scenario`
The three-way interaction of graph-type, scaffold condition and graph-order approached significance at F(4,297) = 2.03, p = 0.08


```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
MP_scores <- ggplot(l_scores, aes(x = condition, y=value, color=variable, shape=variable)) +
    scale_shape_manual(values=c(15, 17))+
  scale_colour_manual(values = c(green, red),
                      breaks = c("triangular_score","linear_score"),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("0" = "none", "1" = "what-text",
                              "2" = "how-text", "3"="static img", "4"="ix img"))

MP_scores + facet_wrap(~order ,labeller=labeller(order = order_labels) ) +
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  #stat_summary(fun.y = mean, geom = "point") +  #the point
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  stat_summary(fun.y = mean, geom = "point", position=position_dodge(0.2)) +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1,position=position_dodge(0.2)) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Score", color="Graph Task") +
  ggtitle("Mean Score by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
MP_scores <- ggplot(l_scores, aes(x = order, y=value, color=variable)) +
  scale_colour_manual(values = c(red, green),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("LMFirst" = "linear-first", "TMFirst" = "triangular-first"))

MP_scores + facet_wrap(~condition ,labeller=labeller(condition = condition_lables) ) +
  stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Score", color="Graph Type") +
  ggtitle("Mean Score by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
MP_scores <- ggplot(l_scores, aes(x = variable, y=value, color=variable)) +
  scale_colour_manual(values = c(red, green),
                      labels = c("triangular","linear"))
  

MP_scores + facet_grid(~order ~ condition,labeller=labeller(condition = condition_lables) ) +
  stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,15)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  stat_summary(fun.y = mean, geom = "point") +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Score", color="Graph Type") +
  ggtitle("Mean Score by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

####4. Results: Drawing Score
```{r echo = FALSE}
# create a subset dataframe that only deals with response times 
#create subsets of runtimes
w_draw_s = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios", "drawScore")) #create a wide form subset 
l_draw_s <-melt(w_draw_s, id=c("subject","condition", "order", "lm_scenarios"), measured=c("drawScore")) #create a longform version

w_draw_t = subset(df_subjects, select = c("subject","condition", "order", "lm_scenarios", "DT_T_M")) #create a wide form subset 
l_draw_t <-melt(w_draw_t, id=c("subject","condition", "order", "lm_scenarios"), measured=c("DT_T_M")) #create a longform version

```
> What were the means and variance of drawing times and scores?

```{r echo = FALSE}
stat.desc(w_draw_s)
stat.desc(w_draw_t)
```

> Are drawing time and score correlated? 

```{r echo = FALSE}
#EXPLORE time and score data via scatterplot
g <-ggplot(df_subjects, aes(x=DT_T_M, y=drawScore))+geom_point() +
    labs(x="Total Runtime", y="Total Score") +
    ggtitle("Runtime and Score (across all Factors)") +
    theme_bw() +
    theme(strip.background = element_blank()) 
g
```


> What were the mean time and scores by scaffold group on the drawing task?

```{r results = 'asis', echo = FALSE}
#Create a tables of means for drawing time and score

table = tabular (condition +1 ~ Format(digits=2)* 
                   (Heading ("Draw Score")*drawScore) * (mean + sd), data = w_draw_s)
table

table = tabular (condition +1 ~ Format(digits=2)* 
                   (Heading ("Draw Time")*DT_T_M) * (mean + sd), data = w_draw_t)
table
#html(table,options=htmloptions(head=TRUE))
#latex(table)
```

#####Construct an ANOVA for drawing score
1. Explore descriptives for each factor 
```{r echo = FALSE}
#explore descriptive statistics based on each IV
#by(l_draw_s$value, list(l_draw_s$condition, l_draw_s$order, l_draw_s$variable), stat.desc, basic=FALSE)
```
```{r echo = FALSE}
#compute and evaluate difference in response time
#by(l_draw_s$value, l_draw_s$condition, stat.desc)

#conduct levene test for homogonaeity of variance (should NOT be significant)
#leveneTest(l_draw_s$value, l_draw_s$condition, center=median)

drawScoreModel <- aov(value~condition*order*lm_scenarios, data = l_draw_s)
summary(drawScoreModel)
summary.lm(drawScoreModel)

```
#####Construct an ANOVA for drawing time
1. Explore descriptives for each factor 
```{r echo = FALSE}
#explore descriptive statistics based on each IV
#by(l_draw_t$value, list(l_draw_t$condition, l_draw_t$order, l_draw_t$variable), stat.desc, basic=FALSE)
```
```{r echo = FALSE}
#compute and evaluate difference in response time
#by(l_draw_t$value, l_draw_t$condition, stat.desc)

#conduct levene test for homogonaeity of variance (should NOT be significant)
#leveneTest(l_draw_t$value, l_draw_t$condition, center=median)

drawTimeModel <- aov(value~condition*order*lm_scenarios, data = l_draw_t)
summary(drawTimeModel)
summary.lm(drawTimeModel)

```

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
d_scores <- ggplot(df_subjects, aes(x = condition, y=drawScore)) +
  scale_colour_manual(values = c(green, red),
                      breaks = c("triangular_score","linear_score"),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("0" = "none", "1" = "what-text",
                              "2" = "how-text", "3"="static img", "4"="ix img"))

d_scores + facet_wrap(~order ,labeller=labeller(order = order_labels) ) +
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,20)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  #stat_summary(fun.y = mean, geom = "point") +  #the point
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  stat_summary(fun.y = mean, geom = "bar", position=position_dodge(0.2)) +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1,position=position_dodge(0.2)) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Score", color="Graph Task") +
  ggtitle("Mean Drawing Score by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

```{r echo = FALSE}
#construct MEANS PLOT of TASK TIME facet by order
d_times <- ggplot(df_subjects, aes(x = condition, y=DT_T_M)) +
  scale_colour_manual(values = c(green, red),
                      breaks = c("triangular_score","linear_score"),
                      labels = c("triangular","linear"))+
  scale_x_discrete(labels=c("0" = "none", "1" = "what-text",
                              "2" = "how-text", "3"="static img", "4"="ix img"))

d_times + facet_wrap(~order ,labeller=labeller(order = order_labels) ) +
  #stat_summary(aes(y = value,group=variable), fun.y=mean,  geom="line") +
  coord_cartesian(ylim=c(0,20)) +
  scale_y_continuous(minor_breaks = seq(0 , 30))+
  #stat_summary(fun.y = mean, geom = "point") +  #the point
  #stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1) +
  stat_summary(fun.y = mean, geom = "bar", position=position_dodge(0.2)) +  #the point
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = .1,position=position_dodge(0.2)) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  labs(x="Scaffold Condition", y="Score", color="Graph Task") +
  ggtitle("Mean Drawing Time by Graph, Scaffold and Order") +
  theme_bw() +
  theme(strip.background = element_blank())
```

> Drawing Interpretation 






###Summaries Drawing Interpretation 
```{r results = 'asis', echo = FALSE}


#create contingency table for drawing interpretation
tbl = table(df_subjects$condition, df_subjects$`Graph Type`)
tbl

chisq.test(tbl) 

tbl = table(df_subjects$`Graph Type`)
tbl
```

```{r echo = FALSE}
#bar chart of graph interpretations
g <- ggplot(df_subjects, aes(`Graph Type`))
g + geom_bar() + 
  ggtitle("Frequency of Graph Types in Drawing Task") + 
  labs(x="Graph Type in Drawing ", y="Number of Participants") + 
  theme_bw() +
  theme(strip.background = element_blank()) +
  theme(plot.title = element_text(family = "Helvetica", color="#666666", face="bold", size=12, hjust=0.5)) + 
  theme(axis.title = element_text(family = "Helvetica", color="#666666", face="bold", size=10)) +
  theme(panel.border = element_blank())
```


> Pairwise comparisons & simple contrasts

